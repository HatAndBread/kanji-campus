<div id="anchor"></div>
<div data-controller="canvas" class="min-h-screen" data-logged-in="<%= current_user ? "1" : "" %>">
  <div data-canvas-target="mondais" class="hidden">
    <% @study_set.mondais.each do |mondai| %>
      <div data-yomikata="<%= mondai.yomikata %>" data-kanji="<%= mondai.kanji %>" class="mondai"></div>
    <% end %>
  </div>
  <div class="fixed flex items-center justify-center top-0 left-0 w-screen h-screen bg-slate-800 opacity-50 z-50 hidden" data-canvas-target="loader">
    <div class="loader"></div>
  </div>

  <div id="canvas-wrapper">
    <div class="h-[250px] relative mt-8 w-[90%] max-w-[800px] mx-auto rounded overflow-hidden border border-gray-500">
      <div class="absolute z-10 w-full flex gap-8 p-2 border-b bg-accent text-accent-content">
        <button data-action="click->canvas#undo" class="" title="undo">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.8" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" />
          </svg>
        </button>
        <button data-action="click->canvas#erase" class="" title="erase">
          <svg width="24" height="24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd">
            <path d="M5.662 23l-5.369-5.365c-.195-.195-.293-.45-.293-.707 0-.256.098-.512.293-.707l14.929-14.928c.195-.194.451-.293.707-.293.255 0 .512.099.707.293l7.071 7.073c.196.195.293.451.293.708 0 .256-.097.511-.293.707l-11.216 11.219h5.514v2h-12.343zm3.657-2l-5.486-5.486-1.419 1.414 4.076 4.072h2.829zm6.605-17.581l-10.677 10.68 5.658 5.659 10.676-10.682-5.657-5.657z"/>
          </svg>
        </button>
        <button data-action="click->canvas#setCurrentQuestion" class="text-accent-content underline absolute right-4" data-canvas-target="skipBtn">Skip Question</button>
      </div>
      <div class="absolute w-full flex justify-center">
        <canvas id="can" height="250" width="500" class="rounded touch-none bg-base-100" style="cursor: crosshair;" data-canvas-target="canvas"></canvas>
        <%= image_tag "maru.png", loading: "lazy", class: "absolute pointer-events-none select-none w-[96px] h-[84px] left-0 right-0 bottom-0 top-0 m-auto opacity-0 transition", data: {"canvas-target" => "maru"} %>
        <%= image_tag "sankaku.png", loading: "lazy", class: "absolute pointer-events-none select-none w-[96px] h-[84px] left-0 right-0 bottom-0 top-0 m-auto opacity-0 transition", data: {"canvas-target" => "sankaku"} %>
        <%= image_tag "batsu.png", loading: "lazy", class: "absolute pointer-events-none select-none w-[96px] h-[84px] left-0 right-0 bottom-0 top-0 m-auto opacity-0 transition", data: {"canvas-target" => "batsu"} %>
      </div>
    </div>
  </div>

  <div class="flex flex-col items-left gap-4 w-[90%] max-w-[800px] mx-auto mb-16 mt-8">
    <div class="font-kanji text-[112px] flex gap-4 w-full max-w-[100vw] overflow-x-scroll" data-canvas-target="stroke"></div>
    <div data-canvas-target="currentQuestion" class="text-2xl"></div>
    <div class="flex md:justify-between flex-col items-start md:flex-row">
      <div data-canvas-target="userAnswerDisplay" class="hidden text-lg md:text-2xl"></div>
      <button class="link link-secondary mb-4" data-canvas-target="markCorrect" data-action="click->canvas#markCorrect">Mark as correct</button>
    </div>
    <button data-action="click->canvas#recognize" class="btn btn-secondary text-secondary-content !w-full" data-canvas-target="checkBtn">Check</button>
    <button data-action="click->canvas#setCurrentQuestion" class="btn btn-secondary text-secondary-content !w-full hidden" data-canvas-target="nextBtn">Next Question</button>
    <button class="btn btn-accent !w-full hidden" data-canvas-target="saveBtn" data-action="click->canvas#submitResult">Save Results
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
      </svg>
    </button>
    <div class="w-full bg-base-300 rounded p-2 mt-6">
      <div class="font-semibold">Question: <span data-canvas-target="currentNum">1</span> out of <span>10</span></div>
      <div class="font-semibold">Percentage: <span data-canvas-target="percentage">--%</span></div>
      <progress class="progress progress-success w-full" value="100" max="100" data-canvas-target="progress"></progress>
    </div>
  </div>
  <label for="nothing-modal" class="hidden" data-canvas-target="modal"></label>
  <% if current_user %>
    <%= form_with model: @writing_session, data: {canvas_target: "form"}, class: "hidden" do |form| %>
      <%= form.number_field :answered, data: {canvas_target: "formAnswered"} %>
      <%= form.number_field :correct, data: {canvas_target: "formCorrect"} %>
    <% end %>
  <% end %>
</div>